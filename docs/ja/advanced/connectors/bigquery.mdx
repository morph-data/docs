---
title: "BigQuery"
icon: "database"
---

## BigQuery ã«æ¥ç¶šã™ã‚‹

ã‚³ãƒã‚¯ã‚¿ãƒ¼ã«ã¤ã„ã¦ã®æ¦‚è¦ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- [DB/SaaSã¨æ¥ç¶šã™ã‚‹](/docs/ja/develop/guides/integration)

<Tabs>
  <Tab title="ã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆ">
    <Steps>
      <Step title="Connectorã‚’ä½œæˆã™ã‚‹">
        ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®ã€ŒConnectorsã€ã‚¿ãƒ–ã‚’é¸æŠã—ã€ŒCreateã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¾ã™ã€‚
        <img src="/assets/images/docs/advanced/connectors/connect-data-platform-connection.png" alt="Connection" />
      </Step>

      <Step title="BigQueryã®èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹">
        BigQueryã§ã¯ï¼’ã¤ã®èªè¨¼æ–¹å¼ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

        ### ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ–¹å¼ã§æ¥ç¶šã™ã‚‹

        BigQuery (Service Account)ã‚’é¸æŠã—è¡¨ç¤ºã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ ã«æ¥ç¶šã™ã‚‹èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

        <img src="/assets/images/docs/advanced/connectors/connect-data-platform-bigquery-sa-create.png" alt="BigQuery Service Account Connection Create" />

        | é …ç›®å            | èª¬æ˜                                      | å¿…é ˆ  | ä¾‹                            |
        |-------------------|-------------------------------------------|-------|-------------------------------|
        | `Credential`           | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON      | âœ…    | `{"project_id": "", ...}`                |

        ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆã«ã¤ã„ã¦ã¯å…¬å¼ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

        - [ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹](https://cloud.google.com/iam/docs/service-accounts-create?hl=ja)


        ### OAuthã§æ¥ç¶šã™ã‚‹

        BigQuery (OAuth)ã‚’é¸æŠã—è¡¨ç¤ºã•ã‚ŒãŸGoogleã¸ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¦èªè¨¼ã—ã¾ã™ã€‚

        <img src="/assets/images/docs/advanced/connectors/connect-data-platform-bigquery-oauth-create.png" alt="BigQuery OAuth Connection Create" />

        ãã®ä»–å…±é€šã§å…¥åŠ›ãŒå¿…è¦ãªé …ç›®ã¯ä»¥ä¸‹ã§ã™ã€‚

        | é …ç›®å            | èª¬æ˜                                      | å¿…é ˆ  | ä¾‹                            |
        |-------------------|-------------------------------------------|-------|-------------------------------|
        | `Project ID`           | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID      | âœ…    | `demo-project`                |
        | `Dataset`           | ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå    |     | `demo_dataset`                       |
        | `Location`       | ãƒ­ãƒ¼ã‚±ãƒ¼ã‚·ãƒ§ãƒ³              |     | `asia-northeast1`                |

        å…¥åŠ›å¾ŒCreateãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ä½œæˆãŒå®Œäº†ã—ã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ä¸å‚™ãŒã‚ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚æ¥ç¶šå†…å®¹ãŒæ­£ã—ã„ã‹å†åº¦ã”ç¢ºèªãã ã•ã„ã€‚

      </Step>
      <Step title="ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã™ã‚‹">
        ä½œæˆãŒæˆåŠŸã™ã‚‹ã¨ä¸€è¦§è¡¨ç¤ºã‹ã‚‰ã‚³ãƒã‚¯ã‚¿ãƒ¼åã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¢ã‚¤ã‚³ãƒ³æ¨ªã®æ–‡å­—åˆ—ãŒ`connection_name`ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã‚³ãƒ¼ãƒ‰ä¸Šã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šå¯èƒ½ã§ã™ã€‚

        <img src="/assets/images/docs/advanced/connectors/connect-data-platform-bigquery-complete.png" alt="Snowflake Connection Create Complete" />

        SQLã¾ãŸã¯Pythonã®ã‚³ãƒ¼ãƒ‰ã«ä½œæˆã—ãŸã‚³ãƒã‚¯ã‚¿ãƒ¼åã‚’å…¥åŠ›ã—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
        <CodeGroup>
        ```sql SQL
        {{
            config(
                connection="connection_name"
            )
        }}

        select * from table_name
        ```

        ```python Python
        import morph
        from morph import MorphGlobalContext
        from morph_lib.database import execute_sql


        @morph.func
        def main(context: MorphGlobalContext):
            df = execute_sql(
                sql="SELECT * from table_name"
                connection="connection_name"
            )
            return df
        ```
        </CodeGroup>
      </Step>
    </Steps>

  </Tab>
  <Tab title="ãƒ­ãƒ¼ã‚«ãƒ«ç‰ˆ">
    <Info>ãƒ­ãƒ¼ã‚«ãƒ«ç‰ˆã§ã¯ç¾åœ¨Service Accountæ–¹å¼ã®ã¿ãŒã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆå¯èƒ½ã§ã™ã€‚ãã‚Œä»¥å¤–ã®æ–¹å¼ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆã‚’ã”åˆ©ç”¨ã„ãŸã ãã‹ã€ç›´æ¥~/.morph/connections.ymlã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</Info>

    <Steps>
      <Step title="morph initã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹">
        `morph init`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦DBã®æ¥ç¶šæƒ…å ±ã‚’`~/.morph/connections.yml`ã«ä¿å­˜ã—ã¾ã™ã€‚
        ```bash Shell
        morph init
        ```

        <Warning>
        morphãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œãªã£ã¦ã„ãªã„å ´åˆã¯äº‹å‰ã«ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‹ã‚‰ãŠé€²ã¿ãã ã•ã„ã€‚
        ```bash shell
        pip install morph-data
        ```
        </Warning>

        å¯¾è©±å¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¨®é¡ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§Snowflake (User/Password)ã‚’é¸æŠã—ã¾ã™ã€‚
        ```bash Shell
        Select your database type:
        1. PostgreSQL
        2. MySQL
        3. Redshift
        4. SQLServer
        5. Snowflake (User/Password)
        6. BigQuery (Service Account)
        Enter the number corresponding to your database type: 6

        BigQuery (Service Account) selected.
        ```

        ç¶šã„ã¦èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚`slug`ã¯ã‚³ãƒã‚¯ã‚¿ãƒ¼åã¨ã—ã¦æ‰±ã†ã‚‚ã®ã§ã€ã“ã®åå‰ã‚’SQLã‚‚ã—ãã¯Pythonã§æŒ‡å®šã—ã¾ã™ã€‚

        ä»¥ä¸‹ã®å…¥åŠ›ä¾‹ã¯å®Ÿéš›ã«æ¥ç¶šã§ãã‚‹å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
        ```bash shell
        Create a slug for your connection: bigquery-connection
        Enter your BigQuery project ID: demo-project
        Enter your BigQuery keyfile path: ~/path_to_pem_file  
        Enter your BigQuery dataset name (Optional): demo_dataset
        Enter your BigQuery location (Optional): asia-northeast1
        ```

        èªè¨¼æƒ…å ±ã®ä¿å­˜ãŒå®Œäº†ã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        ```bash shell
        Successfully initialized! ğŸ‰
        You can edit your connection details in `path_to_connections.yml`
        ```

        `connections.yml`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»–ã®ã‚³ãƒã‚¯ã‚¿ãƒ¼ã‚’ä½œæˆã—ãŸå ´åˆã¯`connections`ä»¥ä¸‹ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚
        ```bash shell
        cat ~/.morph/connections.yml
        ```

        ```yaml
        connections:
          bigquery-connection:
            dataset: demo_dataset
            keyfile: ~/path_to_pem_file
            location: asia-northeast1
            method: bigquery_service_account
            project: demo-project
            type: bigquery
        ```
      </Step>
      <Step title="ã‚³ãƒ¼ãƒ‰ä¸Šã§ã‚³ãƒã‚¯ã‚¿ãƒ¼ã‚’ä½¿ã„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹">
        SQLã¾ãŸã¯Pythonã®ã‚³ãƒ¼ãƒ‰ã«ä½œæˆã—ãŸã‚³ãƒã‚¯ã‚¿ãƒ¼åã‚’å…¥åŠ›ã—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
        <CodeGroup>
        ```sql SQL
        {{
            config(
                connection="connection_name"
            )
        }}

        select * from table_name
        ```

        ```python Python
        import morph
        from morph import MorphGlobalContext
        from morph_lib.database import execute_sql


        @morph.func
        def main(context: MorphGlobalContext):
            df = execute_sql(
                sql="SELECT * from table_name"
                connection="connection_name"
            )
            return df
        ```
        </CodeGroup>
      </Step>
    </Steps>

    <Warning>
        å®Ÿéš›ã«ã‚³ãƒã‚¯ã‚¿ãƒ¼ã‚’æŒ‡å®šã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ãŸå ´åˆã®å„ªå…ˆé †ä½ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
        ã¾ãŸ`morph deploy`ã‚’è¡Œãªã£ãŸç’°å¢ƒã§ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆã§ä½œæˆã—ãŸã‚³ãƒã‚¯ã‚¿ãƒ¼ã®ã¿ãŒä½¿ç”¨å¯èƒ½ãªãŸã‚æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
        1. ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã®`~/.morph/connections.yml`ã«è¨˜è¼‰ã•ã‚ŒãŸã‚³ãƒã‚¯ã‚¿ãƒ¼
        2. ã‚¯ãƒ©ã‚¦ãƒ‰ã§ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒã‚¯ã‚¿ãƒ¼
    </Warning>

    ### OAuthã®å ´åˆã®è¨˜è¿°æ–¹æ³•

    OAuthã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯`~/.morph/connections.yml`ã‚’ç›´æ¥ç·¨é›†ã—ã¾ã™ã€‚

    access_tokenã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆã®æ©Ÿèƒ½ã®ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯è¨˜è¼‰ã—ãŸã‚‚ã®ãŒå¸¸æ™‚ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

    **OAuthæ–¹å¼**
    ```yml
    connections:
      bigquery-oauth-connection
        type: bigquery # å›ºå®š
        method: bigquery_oauthã€€# å›ºå®š
        project: str
        refresh_token: str
        client_id: str
        client_secret: str
        redirect_uri: str
        dataset: str # ä»»æ„
        location: str # ä»»æ„
        access_token: str # ä»»æ„
    ```    

  </Tab>  
</Tabs>
